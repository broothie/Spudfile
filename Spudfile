
publish do |message = nil,  segment: 'patch'|
  clean

  new_version = invoke!('gem.bump', segment).split('->').last.strip
  puts new_version
  sh 'bundle'

  message ||= "publish #{new_version}"
  sh "git commit -am '#{message}'"
  sh 'git push'
end

check do
  spec
  sorbet
end

spec do |matcher = '*'|
  paths = Dir.glob("spec/**/*#{matcher}*.rb")
  sh "bundle exec rspec #{paths.join(' ')}"
end

sorbet do
  sh 'bundle exec srb'
end

create do
  invoke 'sandbox.create'
end

clean do
  sh 'rm -rf .byebug_history .rspec_status'
  invoke 'sandbox.clean'
end
